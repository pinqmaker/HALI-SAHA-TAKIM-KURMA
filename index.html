<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Halı Saha Takım Kurucu</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, select, button { margin-right: 5px; margin-bottom: 10px; }
    .team { margin-top: 20px; }
    .team h3 { margin-bottom: 5px; }
    ul { list-style-type: none; padding: 0; }
    li { padding: 3px 0; }
    #playerDropdown { margin-bottom: 10px; }
  </style>
</head>
<body>
  <h2>Halı Saha Takım Kurucu</h2>

  <input type="text" id="playerName" placeholder="Oyuncu adı" />
  <select id="playerRole">
    <option value="Kaleci">Kaleci</option>
    <option value="Defans">Defans</option>
    <option value="Orta Saha">Orta Saha</option>
    <option value="Forvet">Forvet</option>
  </select>
  <select id="playerSkill">
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5" selected>5</option>
    <option value="6">6</option>
    <option value="7">7</option>
    <option value="8">8</option>
    <option value="9">9</option>
    <option value="10">10</option>
  </select>
  <button onclick="addPlayer()">Ekle</button>

  <h3>Oyuncular (Toplam: <span id="playerCount">0</span>)</h3>
  <ul id="playerList"></ul>

  <h3>Oyuncu Sil</h3>
  <select id="playerDropdown">
    <option disabled selected>Silmek için oyuncu seçin</option>
  </select>
  <button onclick="removePlayer()">Sil</button>

  <button onclick="shuffleTeams()">Karıştır ve Takımları Kur</button>

  <div class="team" id="teamA"></div>
  <div class="team" id="teamB"></div>

  <script>
    // localStorage'dan oyuncu listesi alınır
    let players = JSON.parse(localStorage.getItem('players')) || [];

    // Oyuncu ekle
    function addPlayer() {
      const name = document.getElementById('playerName').value.trim();
      const role = document.getElementById('playerRole').value;
      const power = parseInt(document.getElementById('playerSkill').value);

      if (!name) return alert("Lütfen oyuncu adı girin.");

      players.push({ name, role, power });
      localStorage.setItem('players', JSON.stringify(players)); // localStorage'a kaydet

      document.getElementById('playerName').value = ''; // input'u temizle
      updatePlayerList(); // oyuncu listesine ekle
    }

    // Oyuncu listesini güncelle
    function updatePlayerList() {
      const playerList = document.getElementById('playerList');
      const playerCount = document.getElementById('playerCount');
      const playerDropdown = document.getElementById('playerDropdown');

      playerList.innerHTML = players.map(p => 
        `<li>${p.name} (${p.role}, Güç: ${p.power})</li>`
      ).join('');

      playerDropdown.innerHTML = '<option disabled selected>Silmek için oyuncu seçin</option>' + 
        players.map(p => `<option value="${p.name}">${p.name}</option>`).join('');

      // Oyuncu sayısını güncelle
      playerCount.textContent = players.length;
    }

    // Takımları karıştır ve dengele
    function shuffleTeams() {
      if (players.length !== 14) {
        alert("Tam olarak 14 oyuncu eklenmeli! Şu an: " + players.length);
        return;
      }

      const shuffled = shuffle([...players]);
      const teamA = [];
      const teamB = [];

      const roleGroups = {
        'Kaleci': [],
        'Defans': [],
        'Orta Saha': [],
        'Forvet': []
      };

      shuffled.forEach(p => roleGroups[p.role].push(p));

      // Dengeli rol dağılımı hedeflenerek sırayla A/B takımlarına dağıt
      for (let role in roleGroups) {
        const playersInRole = roleGroups[role];
        let half = Math.floor(playersInRole.length / 2);

        teamA.push(...playersInRole.slice(0, half));
        teamB.push(...playersInRole.slice(half));
      }

      // Her iki takımı da 7 kişilik yap
      while (teamA.length < 7) {
        teamA.push(shuffled.pop());
      }
      while (teamB.length < 7) {
        teamB.push(shuffled.pop());
      }

      const totalPowerA = teamA.reduce((sum, p) => sum + p.power, 0);
      const totalPowerB = teamB.reduce((sum, p) => sum + p.power, 0);

      document.getElementById('teamA').innerHTML = `
        <h3>A Takımı (Toplam Güç: ${totalPowerA})</h3>
        <ul>${teamA.map(p => `<li>${p.name} (${p.role}, Güç: ${p.power})</li>`).join('')}</ul>
      `;

      document.getElementById('teamB').innerHTML = `
        <h3>B Takımı (Toplam Güç: ${totalPowerB})</h3>
        <ul>${teamB.map(p => `<li>${p.name} (${p.role}, Güç: ${p.power})</li>`).join('')}</ul>
      `;
    }

    // Karışık sırayla oyuncuları diz
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // Oyuncu sil
    function removePlayer() {
      const selectedPlayer = document.getElementById('playerDropdown').value;
      if (!selectedPlayer) return alert("Lütfen bir oyuncu seçin.");

      players = players.filter(p => p.name !== selectedPlayer);
      localStorage.setItem('players', JSON.stringify(players)); // localStorage'dan sil

      updatePlayerList(); // oyuncu listesine güncelle
    }

    // Sayfa yüklendiğinde oyuncu listelerini güncelle
    updatePlayerList();
  </script>
</body>
</html>
